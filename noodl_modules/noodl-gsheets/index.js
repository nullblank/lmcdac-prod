!function(e){var t={};function s(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=e,s.c=t,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(n,i,function(t){return e[t]}.bind(null,i));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(module,exports,__webpack_require__){const Noodl=__webpack_require__(1),PublicGoogleSheetsParser=__webpack_require__(2),EventEmitter=__webpack_require__(3).EventEmitter;var _schemas,_schemaEvents;function _addSheetToSchemas(e,t,s){new PublicGoogleSheetsParser(e,t,"limit 0").parse().then(({rows:e,cols:n})=>{const i={},o={boolean:{type:"Boolean"},string:{type:"String"},number:{type:"Number"},date:{type:"Date"},datetime:{type:"Date"}};for(var r=0;r<n.length;r++){const e=n[r].label;""!==e&&(i[e]=o[n[r].type])}_schemas[t||"_Default"]=Object.assign(_schemas[t||"_Default"]||{},i),_schemaEvents.emit("change",{schema:t}),s()})}const _colsCache={};function _getColumns(e,t,s){if(void 0!==_colsCache[e]&&void 0!==_colsCache[e][t])return void 0!==_colsCache[e][t]._cbs?void _colsCache[e][t]._cbs.push(s):s(_colsCache[e][t]);void 0===_colsCache[e]&&(_colsCache[e]={}),_colsCache[e][t]={_cbs:[s]};new PublicGoogleSheetsParser(e,t,"limit 0").parse().then(({rows:s,cols:n})=>{const i={};n.forEach(e=>i[e.label]=e);const o=_colsCache[e][t]._cbs;_colsCache[e][t]=i,o.forEach(e=>e(i))})}function _formatFilter(e,t){var s=t.queryParameters;if(void 0!==e.combinator&&void 0!==e.rules){if(0===e.rules.length)return;if(1===e.rules.length)return _formatFilter(e.rules[0],t);var n="(";return e.rules.forEach((s,i)=>{var o=_formatFilter(s,t);void 0!==o&&(n+=o,i<e.rules.length-1&&(n+=e.combinator+" "))}),n+=")"}if(void 0!==e.property){var i,o=void 0!==e.input?s[e.input]:e.value;if(void 0===o)return;"string"==typeof o&&(o="'"+o+"'"),"exist"===e.operator?i="is not null":"not exist"===e.operator?i="is null":"greater than"===e.operator?i="> "+o:"greater than or equal to"===e.operator?i=">= "+o:"less than"===e.operator?i="< "+o:"less than or equal to"===e.operator?i="<= "+o:"equal to"===e.operator?i="= "+o:"not equal to"===e.operator&&(i="!= "+o);return t.cols[e.property].id+" "+i}}const QuerySheetNode=Noodl.defineNode({name:"noodl.gsheets.QuerySheetNode",displayName:"Query Sheet",color:"green",docs:"https://docs.noodl.net/modules/gsheets/node-docs/query-sheet/README",initialize(){this.queryParameters={}},inputs:{sheetId:{displayName:"Document Id",group:"Sheet Source",type:"string"},sheetName:{displayName:"Sheet Name",group:"Sheet Source",type:"string"}},outputs:{result:{displayName:"Items",group:"General",type:"array"},count:{displayName:"Count",group:"General",type:"number"},firstItemId:{displayName:"First Item Id",group:"General",type:"string"},success:{displayName:"Success",group:"Events",type:"signal"},failure:{displayName:"Failure",group:"Events",type:"signal"},error:{displayName:"Error",group:"Error",type:"string"}},signals:{Do(){this.scheduleQuery()}},changed:{sheetId(){this.cols=void 0,!1===this.isInputConnected("Do")&&this.scheduleQuery()},sheetName(){this.cols=void 0,!1===this.isInputConnected("Do")&&this.scheduleQuery()}},methods:{scheduleQuery(){this.queryScheduled||(this.queryScheduled=!0,this.scheduleAfterInputsHaveUpdated(()=>{this.queryScheduled=!1,this.runQuery()}))},setError:function(e){this.setOutputs({error:e}),this.sendSignalOnOutput("failure")},runQuery(){void 0!==this.inputs.sheetId&&void 0!==this.inputs.sheetName&&_getColumns(this.inputs.sheetId,this.inputs.sheetName,cols=>{let query;if(void 0!==this.filter){const e=_formatFilter(this.filter,{cols:cols,queryParameters:this.queryParameters});void 0!==e&&(query="where "+e+" ")}void 0!==this.sorting&&(query=(query||"")+"order by "+this.sorting.map((e,t)=>(0!==t?" ":"")+cols[e.property].id+("descending"===e.order?" desc":"")).join(" ")+" "),this.enableLimit&&(query=(query||"")+"limit "+(void 0!==this.limit?this.limit:10)+" ",void 0!==this.skip&&(query=(query||"")+"offset "+this.skip+" "));const parser=new PublicGoogleSheetsParser(this.inputs.sheetId,this.inputs.sheetName,query);parser.parse().then(({rows:rows,_cols:_cols})=>{const results=Noodl.Array.get();results.set(rows.map(r=>{let _id;for(var key in void 0!==this.useColumnForId&&"__none__"!==this.useColumnForId&&(_id=r[this.useColumnForId]),r)!cols[key]||"date"!=cols[key].type&&"datetime"!=cols[key].type||(r[key]=eval("new "+r[key]));let obj=Noodl.Object.get(_id);return obj.setAll(r),obj})),this.setOutputs({result:results,count:results.size(),firstItemId:results.size()>0?results.get(0).getId():void 0}),this.sendSignalOnOutput("success")})})},registerInputIfNeeded:function(e){if(!this.hasInput(e))return"visualFilter"===e&&this.registerInput(e,{set:this.setFilter.bind(this)}),"visualSort"===e&&this.registerInput(e,{set:this.setSorting.bind(this)}),"enableLimit"===e&&this.registerInput(e,{set:this.setEnableLimit.bind(this)}),"limit"===e&&this.registerInput(e,{set:this.setLimit.bind(this)}),"skip"===e&&this.registerInput(e,{set:this.setSkip.bind(this)}),"columnForId"===e&&this.registerInput(e,{set:this.setColumnForId.bind(this)}),e.startsWith("qp-")?this.registerInput(e,{set:this.setQueryParameter.bind(this,e.substring("qp-".length))}):void 0},setFilter(e){this.filter=e,!1===this.isInputConnected("Do")&&this.scheduleQuery()},setSorting(e){this.sorting=e,!1===this.isInputConnected("Do")&&this.scheduleQuery()},setEnableLimit(e){this.enableLimit=e,!1===this.isInputConnected("Do")&&this.scheduleQuery()},setLimit(e){this.limit=e,!1===this.isInputConnected("Do")&&this.scheduleQuery()},setSkip(e){this.skip=e,!1===this.isInputConnected("Do")&&this.scheduleQuery()},setColumnForId(e){this.useColumnForId=e,!1===this.isInputConnected("Do")&&this.scheduleQuery()},setQueryParameter(e,t){this.queryParameters[e]=t,!1===this.isInputConnected("Do")&&this.scheduleQuery()}},setup:function(e,t){e.editorConnection&&e.editorConnection.isRunningLocally()&&(void 0===_schemas&&(_schemas={}),void 0===_schemaEvents&&(_schemaEvents=new EventEmitter),t.on("nodeAdded.noodl.gsheets.QuerySheetNode",(function(t){function s(){var s=[];if(s.push({type:"boolean",plug:"input",group:"Limit",name:"enableLimit",displayName:"Use limit"}),t.parameters.enableLimit&&(s.push({type:"number",default:10,plug:"input",group:"Limit",name:"limit",displayName:"Limit"}),s.push({type:"number",default:0,plug:"input",group:"Limit",name:"skip",displayName:"Skip"})),void 0===t.parameters.sheetId||void 0===t.parameters.sheetName?e.editorConnection.sendWarning(t.component.name,t.id,"missing-sheet",{message:"You must specify the Id of the Google Sheet document and the sheet name."}):e.editorConnection.clearWarning(t.component.name,t.id,"missing-sheet"),void 0!==t.parameters.sheetId&&void 0!==t.parameters.sheetName){const e={properties:_schemas[t.parameters.sheetName||"_Default"]};if(s.push({name:"visualFilter",plug:"input",type:{name:"query-filter",schema:e,allowEditOnly:!0},displayName:"Filter",group:"Filter"}),void 0!==t.parameters.visualFilter){const e={};!function t(s){void 0!==s&&(void 0!==s.rules?s.rules.forEach(e=>t(e)):void 0!==s.input&&(e[s.input]=!0))}(t.parameters.visualFilter),Object.keys(e).forEach(e=>{s.push({name:"qp-"+e,plug:"input",type:"*",displayName:e,group:"Query Parameters"})})}s.push({name:"visualSort",plug:"input",type:{name:"query-sorting",schema:e,allowEditOnly:!0},displayName:"Sort",group:"Sorting"});const n=[{label:"Unique id",value:"__none__"}].concat(Object.keys(e.properties).map(e=>({value:e,label:e})));s.push({name:"columnForId",plug:"input",type:{name:"enum",enums:n},displayName:"Use Column For Id",group:"Sheet Source",default:"__none__"})}e.editorConnection.sendDynamicPorts(t.id,s)}t.parameters.sheetId&&_addSheetToSchemas(t.parameters.sheetId,t.parameters.sheetName,()=>{s()}),t.on("parameterUpdated",(function(e){"sheetId"!==e.name&&"sheetName"!==e.name||!t.parameters.sheetId||_addSheetToSchemas(t.parameters.sheetId,t.parameters.sheetName,()=>{s()}),"enableLimit"!==e.name&&"visualFilter"!==e.name||s()}))})))}}),QuerySheetAggregateNode=Noodl.defineNode({name:"noodl.gsheets.QuerySheetAggregateNode",displayName:"Query Sheet Aggregate",color:"green",docs:"https://docs.noodl.net/modules/gsheets/node-docs/query-sheet-aggregate/README",inputs:{sheetId:{displayName:"Document Id",group:"Sheet Source",type:"string"},sheetName:{displayName:"Sheet Name",group:"Sheet Source",type:"string"},aggType:{displayName:"Aggregate",type:{name:"enum",enums:[{label:"Unique",value:"unique"},{label:"Count",value:"count"},{label:"Min",value:"min"},{label:"Max",value:"max"}]},default:"unique",group:"General"}},outputs:{success:{displayName:"Success",group:"Events",type:"signal"},failure:{displayName:"Failure",group:"Events",type:"signal"},error:{displayName:"Error",group:"Error",type:"string"}},signals:{Do(){this.scheduleQuery()}},changed:{sheetId(){this.cols=void 0,!1===this.isInputConnected("Do")&&this.scheduleQuery()},sheetName(){this.cols=void 0,!1===this.isInputConnected("Do")&&this.scheduleQuery()},aggType(){!1===this.isInputConnected("Do")&&this.scheduleQuery()}},methods:{scheduleQuery(){this.queryScheduled||(this.queryScheduled=!0,this.scheduleAfterInputsHaveUpdated(()=>{this.queryScheduled=!1,this.runQuery()}))},runQuery(){_getColumns(this.inputs.sheetId,this.inputs.sheetName,e=>{let t,s="";if(void 0!==this.filter){const t=_formatFilter(this.filter,{cols:e,queryParameters:this.queryParameters});void 0!==t&&(s="where "+t+" ")}const n=void 0!==this.column?e[this.column].id:"A";void 0===this.inputs.aggType||"unique"===this.inputs.aggType?t=`select ${n}, count(${n}) group by ${n} ${s}`:"count"===this.inputs.aggType?t=`select count(${n}) ${s}`:"min"===this.inputs.aggType?t=`select min(${n}) ${s}`:"max"===this.inputs.aggType&&(t=`select max(${n}) ${s}`);new PublicGoogleSheetsParser(this.inputs.sheetId,this.inputs.sheetName,t).parse().then(({rows:e,cols:t})=>{if(void 0===this.inputs.aggType||"unique"===this.inputs.aggType){this.result=Noodl.Array.get();const s=void 0!==this.column?this.column:t[0].label;this.result.set(e.map(e=>Noodl.Object.create({Value:e[s],Label:e[s]})))}else{const t=Object.keys(e[0]);this.result=e[0][t[0]]}this.hasOutput("result")&&this.flagOutputDirty("result"),this.sendSignalOnOutput("success")})})},registerInputIfNeeded:function(e){if(!this.hasInput(e))return"column"===e&&this.registerInput(e,{set:this.setColumn.bind(this)}),"visualFilter"===e&&this.registerInput(e,{set:this.setFilter.bind(this)}),e.startsWith("qp-")?this.registerInput(e,{set:this.setQueryParameter.bind(this,e.substring("qp-".length))}):void 0},setFilter(e){this.filter=e,!1===this.isInputConnected("Do")&&this.scheduleQuery()},setQueryParameter(e,t){this.queryParameters[e]=t,!1===this.isInputConnected("Do")&&this.scheduleQuery()},setColumn(e){this.column=e,!1===this.isInputConnected("Do")&&this.scheduleQuery()},registerOutputIfNeeded:function(e){this.hasOutput(e)||"result"===e&&this.registerOutput(e,{getter:this.getResult.bind(this)})},getResult(){return this.result}},setup:function(e,t){e.editorConnection&&e.editorConnection.isRunningLocally()&&(void 0===_schemas&&(_schemas={}),void 0===_schemaEvents&&(_schemaEvents=new EventEmitter),t.on("nodeAdded.noodl.gsheets.QuerySheetAggregateNode",(function(t){function s(){var s=[];if(void 0===t.parameters.sheetId||void 0===t.parameters.sheetName?e.editorConnection.sendWarning(t.component.name,t.id,"missing-sheet",{message:"You must specify the Id of the Google Sheet document and the sheet name."}):e.editorConnection.clearWarning(t.component.name,t.id,"missing-sheet"),void 0!==t.parameters.sheetId&&void 0!==t.parameters.sheetName){const e={properties:_schemas[t.parameters.sheetName||"_Default"]};if(s.push({name:"visualFilter",plug:"input",type:{name:"query-filter",schema:e,allowEditOnly:!0},displayName:"Filter",group:"Filter"}),void 0!==t.parameters.visualFilter){const e={};!function t(s){void 0!==s&&(void 0!==s.rules?s.rules.forEach(e=>t(e)):void 0!==s.input&&(e[s.input]=!0))}(t.parameters.visualFilter),Object.keys(e).forEach(e=>{s.push({name:"qp-"+e,plug:"input",type:"*",displayName:e,group:"Query Parameters"})})}const n=Object.keys(e.properties).map(e=>({value:e,label:e}));n.length>0&&s.push({name:"column",plug:"input",type:{name:"enum",enums:n},displayName:"Column",group:"Sheet Source",default:n[0].value}),void 0===t.parameters.aggType||"unique"===t.parameters.aggType?s.push({displayName:"Result",group:"General",type:"array",plug:"output",name:"result"}):s.push({displayName:"Result",group:"General",type:"number",plug:"output",name:"result"})}e.editorConnection.sendDynamicPorts(t.id,s)}t.parameters.sheetId&&_addSheetToSchemas(t.parameters.sheetId,t.parameters.sheetName,()=>{s()}),t.on("parameterUpdated",(function(e){"sheetId"!==e.name&&"sheetName"!==e.name||!t.parameters.sheetId||_addSheetToSchemas(t.parameters.sheetId,t.parameters.sheetName,()=>{s()}),"aggType"!==e.name&&"visualFilter"!==e.name||s()}))})))}}),SheetRowNode=Noodl.defineNode({name:"noodl.gsheets.SheetRowNode",displayName:"Sheet Row",color:"green",docs:"https://docs.noodl.net/modules/gsheets/node-docs/sheet-row/README",inputs:{rowId:{type:{name:"string",allowConnectionsOnly:!0},displayName:"Row Id"}},outputs:{},changed:{rowId(e){this.rowObject=Noodl.Object.get(e),this.updateOutputs()}},methods:{registerOutputIfNeeded(e){this.hasOutput(e)||e.startsWith("prop-")&&this.registerOutput(e,{getter:this.getColumnValue.bind(this,e.substring("prop-".length))})},registerInputIfNeeded(e){this.hasInput(e)||"sheet"===e&&this.registerInput(e,{set:()=>{}})},getColumnValue(e){if(void 0!==this.rowObject)return this.rowObject.get(e)},updateOutputs(){if(void 0===this.rowObject)return;const e={};Object.keys(this.rowObject.data).forEach(t=>{this.hasOutput("prop-"+t)&&(e["prop-"+t]=this.rowObject[t])}),this.setOutputs(e)}},setup:function(e,t){e.editorConnection&&e.editorConnection.isRunningLocally()&&(void 0===_schemas&&(_schemas={}),void 0===_schemaEvents&&(_schemaEvents=new EventEmitter),t.on("nodeAdded.noodl.gsheets.SheetRowNode",(function(t){function s(){var s=[];const n=Object.keys(_schemas).map(e=>({value:e,label:e}));n.length>1&&s.push({name:"sheet",plug:"input",type:{name:"enum",enums:n},displayName:"Sheet",group:"General"});const i=1===n.length?n[0].value:t.parameters.sheet;if(void 0!==i){const e=_schemas[i];if(void 0!==e)for(let t in e){const n=e[t].type,i={Boolean:"boolean",Number:"number",String:"string",Date:"date"};s.push({name:"prop-"+t,plug:"output",type:i[n]||"*",displayName:t,group:"Columns"})}}e.editorConnection.sendDynamicPorts(t.id,s)}s(),_schemaEvents.on("change",()=>{s()}),t.on("parameterUpdated",(function(e){s()}))})))}});Noodl.defineModule({nodes:[QuerySheetNode,QuerySheetAggregateNode,SheetRowNode],setup(){}})},function(e,t){const s={purple:"component",green:"data",default:"default",grey:"default"};Noodl.defineNode=function(e){const t={};for(var n in t.name=e.name,t.displayNodeName=e.displayName,t.usePortAsLabel=e.useInputAsLabel,t.color=s[e.color||"default"],t.category=e.category||"Modules",t.getInspectInfo=e.getInspectInfo,t.docs=e.docs,t.initialize=function(){this.inputs={};var t=this.outputs={},s=this;this.setOutputs=function(e){for(var n in e)t[n]=e[n],s.flagOutputDirty(n)},this.clearWarnings=function(){this.context.editorConnection&&this.nodeScope&&this.nodeScope.componentOwner&&this.context.editorConnection.clearWarnings(this.nodeScope.componentOwner.name,this.id)}.bind(this),this.sendWarning=function(e,t){this.context.editorConnection&&this.nodeScope&&this.nodeScope.componentOwner&&this.context.editorConnection.sendWarning(this.nodeScope.componentOwner.name,this.id,e,{message:t})}.bind(this),"function"==typeof e.initialize&&e.initialize.apply(this)},t.inputs={},t.outputs={},e.inputs)t.inputs[n]={type:"object"==typeof e.inputs[n]?e.inputs[n].type:e.inputs[n],displayName:"object"==typeof e.inputs[n]?e.inputs[n].displayName:void 0,group:"object"==typeof e.inputs[n]?e.inputs[n].group:void 0,default:"object"==typeof e.inputs[n]?e.inputs[n].default:void 0,set:function(){const t=n;return function(s){this.inputs[t]=s,e.changed&&"function"==typeof e.changed[t]&&e.changed[t].apply(this,[s])}}()};for(var n in e.signals)t.inputs[n]={type:"signal",displayName:"object"==typeof e.signals[n]?e.signals[n].displayName:void 0,group:"object"==typeof e.signals[n]?e.signals[n].group:void 0,valueChangedToTrue:function(){const t=n;return function(){const s="object"==typeof e.signals[t]?e.signals[t].signal:e.signals[t];"function"==typeof s&&this.scheduleAfterInputsHaveUpdated(()=>{s.apply(this)})}}()};for(var n in e.outputs)"signal"===e.outputs[n]?t.outputs[n]={type:"signal"}:t.outputs[n]={type:"object"==typeof e.outputs[n]?e.outputs[n].type:e.outputs[n],displayName:"object"==typeof e.outputs[n]?e.outputs[n].displayName:void 0,group:"object"==typeof e.outputs[n]?e.outputs[n].group:void 0,getter:function(){const e=n;return function(){return this.outputs[e]}}()};for(var n in t.methods=t.prototypeExtensions={},e.methods)t.prototypeExtensions[n]=e.methods[n];return t.methods.onNodeDeleted&&(t.methods._onNodeDeleted=function(){this.__proto__.__proto__._onNodeDeleted.call(this),t.methods.onNodeDeleted.value.call(this)}),{node:t,setup:e.setup}},Noodl.defineCollectionNode=function(e){const t={name:e.name,category:e.category,color:"data",inputs:e.inputs,outputs:Object.assign({Items:"array","Fetch Started":"signal","Fetch Completed":"signal"},e.outputs||{}),signals:Object.assign({Fetch:function(){var t=this;this.sendSignalOnOutput("Fetch Started");var s=e.fetch.call(this,(function(){t.sendSignalOnOutput("Fetch Completed")}));this.setOutputs({Items:s})}},e.signals||{})};return Noodl.defineNode(t)},Noodl.defineModelNode=function(e){const t={name:e.name,category:e.category,color:"data",inputs:{Id:"string"},outputs:{Fetched:"signal"},changed:{Id:function(e){this._object&&this._changeListener&&this._object.off("change",this._changeListener),this._object=Noodl.Object.get(e),this._changeListener=(e,t)=>{const s={};s[e]=t,this.setOutputs(s)},this._object.on("change",this._changeListener),this.setOutputs(this._object.data),this.sendSignalOnOutput("Fetched")}},initialize:function(){}};for(var s in e.properties)t.inputs[s]=e.properties[s],t.outputs[s]=e.properties[s],t.changed[s]=function(){const e=s;return function(t){this._object&&this._object.set(e,t)}}();return Noodl.defineNode(t)},Noodl.defineReactNode=function(e){var t=Noodl.defineNode(e);return t.node.getReactComponent=e.getReactComponent,t.node.inputProps=e.inputProps,t.node.inputCss=e.inputCss,t.node.outputProps=e.outputProps,t.node.setup=e.setup,t.node.frame=e.frame,t.node},e.exports=Noodl},function(e,t){e.exports=class{constructor(e,t,s){this.id=e,this.sheetName=t,this.query=s}getSpreadsheetDataUsingFetch(){if(!this.id)return null;let e=`https://docs.google.com/spreadsheets/d/${this.id}/gviz/tq?`;return this.sheetName&&(e=e.concat("sheet="+this.sheetName)),this.query&&(e=e.concat("&tq="+encodeURIComponent(this.query))),e+="&headers=1",fetch(e).then(e=>e&&e.ok&&e.text?e.text():null).catch(e=>null)}normalizeRow(e){return e.map(e=>e&&null!==e.v&&void 0!==e.v?e:{})}applyHeaderIntoRows(e,t){return t.map(({c:e})=>this.normalizeRow(e)).map(t=>t.reduce((t,s,n)=>void 0!==s.v?Object.assign(t,{[e[n]]:s.v}):t,{}))}getItems(e){let t=[],s=[];try{const n=JSON.parse(e.split("\n")[1].replace(/google.visualization.Query.setResponse\(|\);/g,""));s=n.table.cols;if(n.table.cols.some(({label:e})=>!!e)){const e=n.table.cols.map(({label:e})=>e);t=this.applyHeaderIntoRows(e,n.table.rows)}else{const[e,...s]=n.table.rows,i=this.normalizeRow(e.c).map(e=>e.v);t=this.applyHeaderIntoRows(i,s)}}catch(e){}return{rows:t,cols:s}}async parse(e,t,s){if(e&&(this.id=e),t&&(this.sheetName=t),s&&(this.query=s),!this.id)throw new Error("SpreadsheetId is required.");const n=await this.getSpreadsheetDataUsingFetch();return null===n?[]:this.getItems(n)}}},function(e,t,s){"use strict";var n,i="object"==typeof Reflect?Reflect:null,o=i&&"function"==typeof i.apply?i.apply:function(e,t,s){return Function.prototype.apply.call(e,t,s)};n=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var r=Number.isNaN||function(e){return e!=e};function u(){u.init.call(this)}e.exports=u,e.exports.once=function(e,t){return new Promise((function(s,n){function i(s){e.removeListener(t,o),n(s)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),s([].slice.call(arguments))}y(e,t,o,{once:!0}),"error"!==t&&function(e,t,s){"function"==typeof e.on&&y(e,"error",t,s)}(e,i,{once:!0})}))},u.EventEmitter=u,u.prototype._events=void 0,u.prototype._eventsCount=0,u.prototype._maxListeners=void 0;var a=10;function l(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function p(e){return void 0===e._maxListeners?u.defaultMaxListeners:e._maxListeners}function h(e,t,s,n){var i,o,r,u;if(l(s),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,s.listener?s.listener:s),o=e._events),r=o[t]),void 0===r)r=o[t]=s,++e._eventsCount;else if("function"==typeof r?r=o[t]=n?[s,r]:[r,s]:n?r.unshift(s):r.push(s),(i=p(e))>0&&r.length>i&&!r.warned){r.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+r.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=e,a.type=t,a.count=r.length,u=a,console&&console.warn&&console.warn(u)}return e}function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,s){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:s},i=c.bind(n);return i.listener=s,n.wrapFn=i,i}function m(e,t,s){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?s?[i.listener||i]:[i]:s?function(e){for(var t=new Array(e.length),s=0;s<t.length;++s)t[s]=e[s].listener||e[s];return t}(i):f(i,i.length)}function g(e){var t=this._events;if(void 0!==t){var s=t[e];if("function"==typeof s)return 1;if(void 0!==s)return s.length}return 0}function f(e,t){for(var s=new Array(t),n=0;n<t;++n)s[n]=e[n];return s}function y(e,t,s,n){if("function"==typeof e.on)n.once?e.once(t,s):e.on(t,s);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(o){n.once&&e.removeEventListener(t,i),s(o)}))}}Object.defineProperty(u,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),u.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},u.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},u.prototype.getMaxListeners=function(){return p(this)},u.prototype.emit=function(e){for(var t=[],s=1;s<arguments.length;s++)t.push(arguments[s]);var n="error"===e,i=this._events;if(void 0!==i)n=n&&void 0===i.error;else if(!n)return!1;if(n){var r;if(t.length>0&&(r=t[0]),r instanceof Error)throw r;var u=new Error("Unhandled error."+(r?" ("+r.message+")":""));throw u.context=r,u}var a=i[e];if(void 0===a)return!1;if("function"==typeof a)o(a,this,t);else{var l=a.length,p=f(a,l);for(s=0;s<l;++s)o(p[s],this,t)}return!0},u.prototype.addListener=function(e,t){return h(this,e,t,!1)},u.prototype.on=u.prototype.addListener,u.prototype.prependListener=function(e,t){return h(this,e,t,!0)},u.prototype.once=function(e,t){return l(t),this.on(e,d(this,e,t)),this},u.prototype.prependOnceListener=function(e,t){return l(t),this.prependListener(e,d(this,e,t)),this},u.prototype.removeListener=function(e,t){var s,n,i,o,r;if(l(t),void 0===(n=this._events))return this;if(void 0===(s=n[e]))return this;if(s===t||s.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,s.listener||t));else if("function"!=typeof s){for(i=-1,o=s.length-1;o>=0;o--)if(s[o]===t||s[o].listener===t){r=s[o].listener,i=o;break}if(i<0)return this;0===i?s.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(s,i),1===s.length&&(n[e]=s[0]),void 0!==n.removeListener&&this.emit("removeListener",e,r||t)}return this},u.prototype.off=u.prototype.removeListener,u.prototype.removeAllListeners=function(e){var t,s,n;if(void 0===(s=this._events))return this;if(void 0===s.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==s[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete s[e]),this;if(0===arguments.length){var i,o=Object.keys(s);for(n=0;n<o.length;++n)"removeListener"!==(i=o[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=s[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},u.prototype.listeners=function(e){return m(this,e,!0)},u.prototype.rawListeners=function(e){return m(this,e,!1)},u.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):g.call(e,t)},u.prototype.listenerCount=g,u.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}}]);
//# sourceMappingURL=index.js.map